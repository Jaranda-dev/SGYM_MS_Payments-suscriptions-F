
<div class="payment-history-wrapper">
    
  <div class="history-header">
    
    <div class="header-content">
      <span class="header-title">M√©todos de Pago</span>
      <!-- Bot√≥n crear cuando hay elementos -->
      
    </div>
  </div>

  <div class="payment-list" *ngIf="userPaymentMethod && userPaymentMethod.length > 0">
    <div class="payment-card" *ngFor="let method of userPaymentMethod">
      <div class="payment-card-header">
        <h3 class="payment-id">{{ method.brand | titlecase }} ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ {{ method.last4 }}</h3>
        <span class="payment-status" 
              [ngClass]="{
                'status-default': method.isDefault,
                'status-secondary': !method.isDefault
              }">
          {{ method.isDefault ? 'Predeterminado' : 'Secundario' }}
        </span>
      </div>
      
      <div class="payment-card-content">
        <div class="payment-detail">
          <span class="detail-label">Tipo de Tarjeta</span>
          <span class="detail-value card-brand">{{ method.brand | titlecase }}</span>
        </div>
        
        <div class="payment-detail">
          <span class="detail-label">√öltimos 4 d√≠gitos</span>
          <span class="detail-value card-number">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ {{ method.last4 }}</span>
        </div>
        
        <div class="payment-detail">
          <span class="detail-label">Vencimiento</span>
          <span class="detail-value expiry-date">{{ method.expMonth }}/{{ method.expYear }}</span>
        </div>
        
        <div class="payment-detail">
          <span class="detail-label">Agregado</span>
          <span class="detail-value">{{ method.createdAt | date:'dd/MM/yyyy' }}</span>
        </div>
      </div>

      <!-- Acciones para cada m√©todo de pago -->
      <div class="card-actions">
        <button class="action-btn set-default" 
                *ngIf="!method.isDefault"
                (click)="setDefaultMethod(method)">
          Usar Este M√©todo
        </button>
      
        <button class="action-btn delete-method" 
                (click)="deleteMethod(method.id)">
          Eliminar
        </button>
      </div>
    </div>
  </div>
  
  <!-- Estado vac√≠o - bot√≥n interno cuando no hay elementos -->
  <div class="empty-state" *ngIf="!userPaymentMethod || userPaymentMethod.length === 0">
    <div class="empty-icon">üí≥</div>
    <p>No tienes m√©todos de pago registrados</p>
    <button class="add-method-btn" (click)="addPaymentMethod()">
      Agregar m√©todo de pago
    </button>
  </div>
</div>

<div *ngIf="showCreate" class="modal-overlay">
  <div class="modal-container">
    <app-add-payment-method (closeModal)="showCreate = false" (addOnSuccess)="onAddSuccess($event)" (addOnFailure)="onAddFailure($event)" (closeModal)="closeCreate()"></app-add-payment-method>
  </div>
</div>

<div *ngIf="errorMessage">
  <app-message-toast [message]="errorMessage" [type]="'error'"></app-message-toast>
</div>

<div *ngIf="successMessage">
  <app-message-toast [message]="successMessage" [type]="'success'"></app-message-toast>
</div>


  <div class="footer-actions" *ngIf="userPaymentMethod && userPaymentMethod.length > 0">
    <button class="add-method-btn left-action" (click)="addPaymentMethod()">
      <span class="plus-icon">+</span>
      Agregar M√©todo
    </button>
    <span class="action-spacer"></span>
    <button class="continue-btn right-action" (click)="handlePaymentMethodSelected()">
      <span class="plus-icon">+</span>
      Continuar
    </button>
  </div>
